<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OCHAT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    body {
      display: flex;
      flex-direction: column;
      font-family: Arial, sans-serif;
    }
    header {
      background: #222;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    #chat-box {
      flex: 1;
      padding: 1rem;
      background: #f3f3f3;
      overflow-y: auto;
    }
    .message {
      margin: 0.5rem 0;
      border-radius: 5px;
      padding: 0.5rem;
      max-width: 80%;
    }
    .you {
      background: #0078d7;
      color: white;
      margin-left: auto;
    }
    .stranger {
      background: #e0e0e0;
      margin-right: auto;
    }
    #controls {
      display: flex;
      padding: 0.5rem;
      background: #ddd;
      gap: 0.5rem;
    }
    #message-input {
      flex: 1;
      padding: 0.5rem;
    }
    button {
      padding: 0.5rem 1rem;
      background: #0078d7;
      color: white;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background: #005fa3;
    }
  </style>
 <script>
  const backendURL = "https://omegle-backend-j8q7.onrender.com";
  const socket = io(backendURL);
  const chatBox = document.getElementById("chat-box");
  const input = document.getElementById("message-input");
  const typingIndicator = document.getElementById("typing-indicator");

  function appendMessage(who, text) {
    const div = document.createElement("div");
    div.className = "message " + who;
    div.textContent = (who === "you" ? "You: " : "Stranger: ") + text;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  socket.on("matched", () => {
    chatBox.innerHTML = "";
    appendMessage("stranger", "You've been matched with a stranger.");
  });

  socket.on("message", (msg) => appendMessage("stranger", msg));
  socket.on("partner-left", () => appendMessage("stranger", "Stranger left the chat."));

  function sendMessage() {
    const msg = input.value.trim();
    if (msg) {
      appendMessage("you", msg);
      socket.emit("message", msg);
      input.value = "";
      socket.emit("stop_typing");
    }
  }

  function nextChat() {
    chatBox.innerHTML = "";
    typingIndicator.textContent = "";
    socket.emit("next");
  }

  // Typing indicator logic
  let typingTimeout;
  input.addEventListener("input", () => {
    socket.emit("typing");
    clearTimeout(typingTimeout);
    typingTimeout = setTimeout(() => {
      socket.emit("stop_typing");
    }, 1000);
  });

  socket.on("typing", () => {
    typingIndicator.textContent = "Stranger is typing...";
  });

  socket.on("stop_typing", () => {
    typingIndicator.textContent = "";
  });

  socket.on("warning", (msg) => {
    const warningBox = document.createElement("div");
    warningBox.textContent = msg;
    warningBox.style.color = "red";
    warningBox.style.margin = "10px";
    warningBox.style.fontWeight = "bold";
    document.body.appendChild(warningBox);
    setTimeout(() => {
      warningBox.remove();
    }, 2000);
  });
</script>

</body>
</html>
